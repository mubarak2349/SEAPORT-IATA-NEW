<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airline Outstanding Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
        }

        body {
            padding: 20px;
            overflow-x: hidden;
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            position: relative;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        header p {
            font-size: 1rem;
            opacity: 0.95;
            margin-bottom: 15px;
        }

        .view-only-badge {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.3);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        /* DASHBOARD CARDS */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .card h4 {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            font-family: 'Courier New', monospace;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: linear-gradient(180deg, transparent, rgba(102, 126, 234, 0.1));
        }

        /* CONTROL BAR */
        .control-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .control-bar select,
        .control-bar input {
            padding: 10px 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .control-bar select:focus,
        .control-bar input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .control-bar input[type="search"] {
            flex: 1;
            min-width: 150px;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #667eea;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        /* TABLE */
        .table-wrap {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 16px 12px;
            text-align: left;
            white-space: nowrap;
            border-bottom: 2px solid #ecf0f1;
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid #ecf0f1;
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:nth-child(even) {
            background: #f5f7fa;
        }

        tbody tr:nth-child(even):hover {
            background: #f0f2f7;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-pending {
            background: #fdeaea;
            color: #e74c3c;
        }

        .number-cell {
            font-family: 'Courier New', monospace;
            text-align: right;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
            display: flex;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-paid {
            background: #27ae60;
        }

        .progress-pending {
            background: #e74c3c;
        }

        .progress-avl {
            background: #ecf0f1;
            border-right: 1px solid #bdc3c7;
        }

        /* FLOATING PANELS */
        .floating-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 999;
            animation: slideUp 0.3s ease;
            display: none;
        }

        .floating-panel.show {
            display: flex;
            flex-direction: column;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 12px 12px 0 0;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .panel-close {
            cursor: pointer;
            font-size: 1.5rem;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .panel-close:hover {
            opacity: 1;
        }

        .panel-content {
            padding: 25px;
            flex: 1;
        }

        .config-row,
        .export-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            align-items: center;
        }

        .config-row label {
            min-width: 120px;
            font-weight: 600;
        }

        .config-row input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* SUMMARY PANEL */
        .summary-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: #2c3e50;
        }

        .metric-positive {
            color: #27ae60;
        }

        .metric-negative {
            color: #e74c3c;
        }

        .stat-highlight {
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
        }

        .summary-stats {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .stat-value {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            color: #667eea;
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #27ae60;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.3);
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1001;
            max-width: 300px;
        }

        .notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* FOOTER */
        footer {
            text-align: center;
            padding: 30px 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 40px;
        }

        .footer-credit {
            font-size: 0.8rem;
            color: #95a5a6;
            margin-top: 10px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }

            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .control-bar {
                flex-direction: column;
            }

            .control-bar select,
            .control-bar input {
                width: 100%;
            }

            .btn {
                flex: 1;
                justify-content: center;
            }

            table {
                font-size: 0.8rem;
            }

            th, td {
                padding: 10px 8px;
            }

            .floating-panel {
                width: 95%;
                max-width: 100%;
                bottom: 10px;
                right: 10px;
            }

            .view-only-badge {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            header h1 {
                font-size: 1.4rem;
            }

            header {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .dashboard {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .control-bar {
                padding: 15px;
                gap: 8px;
            }

            .control-bar select,
            .control-bar input,
            .btn {
                font-size: 0.85rem;
                padding: 8px 12px;
            }

            table {
                font-size: 0.75rem;
            }

            th, td {
                padding: 8px 6px;
            }

            .summary-metrics {
                grid-template-columns: 1fr;
            }
        }

        /* Loading state */
        .table-wrap.loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <!-- VIEW-ONLY BADGE -->
    <div class="view-only-badge">üîí View-Only Data</div>

    <!-- HEADER -->
    <header>
        <h1>‚úàÔ∏è Airline Outstanding Dashboard</h1>
        <p>Real-time payment tracking for multiple airlines</p>
        <small id="lastUpdated">Last Updated: <span id="updateTime">‚Äî</span></small>
    </header>

    <!-- DASHBOARD CARDS -->
    <div class="dashboard">
        <div class="card">
            <h4>Current Period Invoice</h4>
            <div class="card-value"><span id="dInv">‚Çπ0</span></div>
            <div class="wave"></div>
        </div>
        <div class="card">
            <h4>Pending Amount</h4>
            <div class="card-value"><span id="dPend">‚Çπ0</span></div>
            <div class="wave"></div>
        </div>
        <div class="card">
            <h4>Pending - AVL</h4>
            <div class="card-value"><span id="dRem">‚Çπ0</span></div>
            <div class="wave"></div>
        </div>
        <div class="card">
            <h4>Total Borrowed</h4>
            <div class="card-value"><span id="dBor">‚Çπ0</span></div>
            <div class="wave"></div>
        </div>
        <div class="card">
            <h4>AVL Balance</h4>
            <div class="card-value"><span id="dAVL">‚Çπ0</span></div>
            <div class="wave"></div>
        </div>
        <div class="card">
            <h4>Overdue Amount</h4>
            <div class="card-value"><span id="dOver">‚Çπ0</span></div>
            <div class="wave"></div>
        </div>
    </div>

    <!-- CONTROL BAR -->
    <div class="control-bar">
        <select id="periodFilter" onchange="applyFilter()">
            <option value="">All Periods (28)</option>
        </select>
        <select id="airlineFilter" onchange="applyFilter()">
            <option value="">All Airlines</option>
            <option value="SL">SriLankan Air</option>
            <option value="AI">Air India</option>
            <option value="SG">Singapore Airlines</option>
        </select>
        <input type="search" id="searchInput" placeholder="Search periods/invoices..." oninput="applySearch()">
        <button class="btn" onclick="toggleExportPanel()">üìä Export</button>
        <button class="btn btn-warning" onclick="showSummary()">üìà Summary</button>
    </div>

    <!-- TABLE -->
    <div class="container">
        <div class="table-wrap">
            <table id="mainTable">
                <thead id="tableHead">
                    <tr>
                        <th>Period</th>
                        <th>Invoice</th>
                        <th>Remittance</th>
                        <th>Days</th>
                        <th colspan="2">SriLankan (SL)</th>
                        <th colspan="2">Air India (AI)</th>
                        <th colspan="2">Singapore (SG)</th>
                        <th>Total</th>
                        <th>Paid</th>
                        <th>Remaining</th>
                        <th>Borrowed</th>
                        <th>AVL</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </div>

    <!-- EXPORT PANEL -->
    <div class="floating-panel" id="exportPanel">
        <div class="panel-header">
            <div class="panel-title">üìä Export Data</div>
            <span class="panel-close" onclick="toggleExportPanel()">‚úï</span>
        </div>
        <div class="panel-content">
            <div class="export-row">
                <button class="btn" onclick="exportCSV()" style="flex:1">üìÑ CSV Export</button>
                <button class="btn" onclick="exportJSON()" style="flex:1">üìã JSON Export</button>
            </div>
            <div class="export-row">
                <button class="btn" onclick="copyTable()" style="flex:1">üìã Copy Table</button>
            </div>
        </div>
    </div>

    <!-- SUMMARY PANEL -->
    <div class="floating-panel" id="summaryPanel">
        <div class="panel-header">
            <div class="panel-title">üìà Executive Summary</div>
            <span class="panel-close" onclick="hideSummary()">‚úï</span>
        </div>
        <div class="panel-content">
            <div class="summary-metrics">
                <div class="metric-card">
                    <div class="metric-label">Total Invoice Value</div>
                    <div class="metric-value stat-highlight" id="sumTotalInv">‚Çπ0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Amount Collected</div>
                    <div class="metric-value metric-positive stat-highlight" id="sumTotalPaid">‚Çπ0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Collection Rate</div>
                    <div class="metric-value metric-positive" id="sumCollectionRate">0%</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Outstanding Balance</div>
                    <div class="metric-value metric-negative stat-highlight" id="sumTotalRem">‚Çπ0</div>
                </div>
            </div>

            <div class="summary-stats">
                <div class="stat-row">
                    <span class="stat-label">Total Borrowed</span>
                    <span class="stat-value" id="sumTotalBor">‚Çπ0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total AVL Balance</span>
                    <span class="stat-value" id="sumTotalAVL">‚Çπ0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Overdue Periods</span>
                    <span class="stat-value metric-negative" id="sumOverdueCount">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Active Airlines</span>
                    <span class="stat-value metric-positive">3</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Periods Tracked</span>
                    <span class="stat-value" id="sumPeriodCount">28</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification"></div>

    <!-- FOOTER -->
    <footer>
        <div>
            Airlines: <strong>3</strong> | Periods: <strong id="periodCount">28</strong> | Status: <strong id="footerStatus">Ready</strong>
        </div>
        <div class="footer-credit">
            Developed by Mcode 3.2 | Founder: Mubarak ¬© 2026
        </div>
    </footer>

    <script>
        // ==================== HARD-CODED DATA ====================
        const periods = [
            ["20251102F", "2025-11-02", "2025-12-09"],
            ["20251201F", "2025-12-01", "2025-12-25"],
            ["20251202F", "2025-12-02", "2026-01-08"],
            ["20260101F", "2026-01-01", "2026-01-25"],
            ["20260102F", "2026-01-02", "2026-02-07"],
            ["20260201F", "2026-02-01", "2026-02-24"],
            ["20260202F", "2026-02-02", "2026-03-07"],
            ["20260301F", "2026-03-01", "2026-03-25"],
            ["20260302F", "2026-03-02", "2026-04-09"],
            ["20260401F", "2026-04-01", "2026-04-25"],
            ["20260402F", "2026-04-02", "2026-05-07"],
            ["20260501F", "2026-05-01", "2026-05-27"],
            ["20260502F", "2026-05-02", "2026-06-09"],
            ["20260601F", "2026-06-01", "2026-06-25"],
            ["20260602F", "2026-06-02", "2026-07-09"],
            ["20260701F", "2026-07-01", "2026-07-25"],
            ["20260702F", "2026-07-02", "2026-08-07"],
            ["20260801F", "2026-08-01", "2026-08-26"],
            ["20260802F", "2026-08-02", "2026-09-09"],
            ["20260901F", "2026-09-01", "2026-09-24"],
            ["20260902F", "2026-09-02", "2026-10-08"],
            ["20261001F", "2026-10-01", "2026-10-25"],
            ["20261002F", "2026-10-02", "2026-11-07"],
            ["20261101F", "2026-11-01", "2026-11-25"],
            ["20261102F", "2026-11-02", "2026-12-09"],
            ["20261201F", "2026-12-01", "2026-12-24"],
            ["20261202F", "2026-12-02", "2027-01-07"],
            ["20270101F", "2027-01-01", "2027-01-25"]
        ];

        // Invoice data: [slAmount, aiAmount, sgAmount, slStatus, aiStatus, sgStatus, paid, borrowed, avl]
        const invoiceData = [
            [1411196, 1061148, 1894593, "PAID", "PAID", "PAID", 4366937, 0, 0],
            [1839350, 489611, 2428937, "PAID", "PAID", "PAID", 4757898, 0, 0],
            [2089753, 724150, 1975908, "PAID", "PAID", "PAID", 4789811, 0, 0],
            [1943404, 617083, 2840655, "PENDING", "PENDING", "PENDING", 0, 0, 500000],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0],
            [0, 0, 0, "PENDING", "PENDING", "PENDING", 0, 0, 0]
        ];

        let filteredData = [];
        let currentFilter = { period: "", airline: "" };

        // ==================== UTILITIES ====================
        function formatCurrency(num) {
            if (!num) return "‚Çπ0";
            return "‚Çπ" + Math.abs(num).toLocaleString('en-IN', { maximumFractionDigits: 0 });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: '2-digit' });
        }

        function getMonthYear(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-IN', { month: 'short', year: 'numeric' });
        }

        function calculateDays(endDate) {
            const today = new Date();
            const end = new Date(endDate);
            const diff = Math.ceil((end - today) / (1000 * 60 * 60 * 24));
            return diff;
        }

        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.classList.add('show');
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        // ==================== DATA PROCESSING ====================
        function buildTable() {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';
            filteredData = [];

            periods.forEach((period, idx) => {
                const invoice = invoiceData[idx];
                const [slAmt, aiAmt, sgAmt, slSts, aiSts, sgSts, paid, bor, avl] = invoice;
                
                const periodObj = {
                    id: period[0],
                    startDate: period[1],
                    endDate: period[2],
                    slAmount: slAmt,
                    aiAmount: aiAmt,
                    sgAmount: sgAmt,
                    slStatus: slSts,
                    aiStatus: aiSts,
                    sgStatus: sgSts,
                    paid: paid,
                    borrowed: bor,
                    avl: avl,
                    total: slAmt + aiAmt + sgAmt,
                    remaining: (slAmt + aiAmt + sgAmt) - paid,
                    days: calculateDays(period[2]),
                    index: idx
                };

                filteredData.push(periodObj);

                const row = document.createElement('tr');
                const daysVal = periodObj.days;
                const dayClass = daysVal < 0 ? 'style="color: #e74c3c; font-weight: 700;"' : '';

                row.innerHTML = `
                    <td><strong>${getMonthYear(periodObj.startDate)}</strong><br><small style="color: #95a5a6;">${periodObj.id}</small></td>
                    <td class="number-cell">${formatDate(periodObj.endDate)}</td>
                    <td class="number-cell">${formatDate(periodObj.startDate)}</td>
                    <td class="number-cell" ${dayClass}>${daysVal} days</td>
                    <td class="number-cell">${formatCurrency(periodObj.slAmount)}</td>
                    <td><span class="status-badge ${periodObj.slStatus === 'PAID' ? 'status-paid' : 'status-pending'}">${periodObj.slStatus}</span></td>
                    <td class="number-cell">${formatCurrency(periodObj.aiAmount)}</td>
                    <td><span class="status-badge ${periodObj.aiStatus === 'PAID' ? 'status-paid' : 'status-pending'}">${periodObj.aiStatus}</span></td>
                    <td class="number-cell">${formatCurrency(periodObj.sgAmount)}</td>
                    <td><span class="status-badge ${periodObj.sgStatus === 'PAID' ? 'status-paid' : 'status-pending'}">${periodObj.sgStatus}</span></td>
                    <td class="number-cell"><strong>${formatCurrency(periodObj.total)}</strong></td>
                    <td class="number-cell" style="color: #27ae60; font-weight: 700;">${formatCurrency(periodObj.paid)}</td>
                    <td class="number-cell" style="color: #e74c3c; font-weight: 700;">${formatCurrency(periodObj.remaining)}</td>
                    <td class="number-cell">${formatCurrency(periodObj.borrowed)}</td>
                    <td class="number-cell">${formatCurrency(periodObj.avl)}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill progress-paid" style="width: ${periodObj.total > 0 ? (periodObj.paid / periodObj.total * 100) : 0}%"></div>
                            <div class="progress-fill progress-pending" style="width: ${periodObj.total > 0 ? ((periodObj.total - periodObj.paid - periodObj.avl) / periodObj.total * 100) : 0}%"></div>
                            <div class="progress-fill progress-avl" style="width: ${periodObj.total > 0 ? (periodObj.avl / periodObj.total * 100) : 0}%"></div>
                        </div>
                        <small style="display: flex; gap: 12px; font-size: 0.75rem; margin-top: 4px;">
                            <span style="color: #27ae60;"><strong>‚úì</strong> ${periodObj.total > 0 ? (periodObj.paid / periodObj.total * 100).toFixed(0) : 0}%</span>
                            <span style="color: #e74c3c;"><strong>‚ö†</strong> ${periodObj.total > 0 ? ((periodObj.total - periodObj.paid - periodObj.avl) / periodObj.total * 100).toFixed(0) : 0}%</span>
                            <span style="color: #7f8c8d;"><strong>‚óê</strong> ${periodObj.total > 0 ? (periodObj.avl / periodObj.total * 100).toFixed(0) : 0}%</span>
                        </small>
                    </td>
                `;
                tbody.appendChild(row);
            });

            updateDashboard();
        }

        function updateDashboard() {
            let totalInv = 0, totalPaid = 0, totalRem = 0, totalBor = 0, totalAVL = 0, totalOver = 0;

            filteredData.forEach(row => {
                totalInv += row.total;
                totalPaid += row.paid;
                totalRem += row.remaining;
                totalBor += row.borrowed;
                totalAVL += row.avl;
                if (row.days < 0) totalOver += row.remaining;
            });

            document.getElementById('dInv').textContent = formatCurrency(totalInv);
            document.getElementById('dPend').textContent = formatCurrency(totalRem);
            document.getElementById('dRem').textContent = formatCurrency(totalRem - totalAVL);
            document.getElementById('dBor').textContent = formatCurrency(totalBor);
            document.getElementById('dAVL').textContent = formatCurrency(totalAVL);
            document.getElementById('dOver').textContent = formatCurrency(totalOver);

            updateSummary(totalInv, totalPaid, totalRem, totalBor, totalAVL);
            updateFooter();
        }

        function updateSummary(inv, paid, rem, bor, avl) {
            const rate = inv > 0 ? ((paid / inv) * 100).toFixed(1) : 0;
            const overdue = filteredData.filter(r => r.days < 0).length;

            document.getElementById('sumTotalInv').textContent = formatCurrency(inv);
            document.getElementById('sumTotalPaid').textContent = formatCurrency(paid);
            document.getElementById('sumCollectionRate').textContent = rate + '%';
            document.getElementById('sumTotalRem').textContent = formatCurrency(rem);
            document.getElementById('sumTotalBor').textContent = formatCurrency(bor);
            document.getElementById('sumTotalAVL').textContent = formatCurrency(avl);
            document.getElementById('sumOverdueCount').textContent = overdue;
            document.getElementById('sumPeriodCount').textContent = filteredData.length;
        }

        function updateFooter() {
            const paid = filteredData.reduce((sum, r) => sum + r.paid, 0);
            const total = filteredData.reduce((sum, r) => sum + r.total, 0);
            const rate = total > 0 ? ((paid / total) * 100).toFixed(0) : 0;
            document.getElementById('footerStatus').textContent = `${rate}% Collected`;
        }

        // ==================== FILTERING ====================
        function applyFilter() {
            const periodVal = document.getElementById('periodFilter').value;
            const airlineVal = document.getElementById('airlineFilter').value;

            currentFilter = { period: periodVal, airline: airlineVal };

            let filtered = [...filteredData];

            if (periodVal) {
                filtered = filtered.filter(r => r.id === periodVal);
            }

            if (airlineVal) {
                filtered = filtered.filter(r => {
                    if (airlineVal === 'SL') return r.slAmount > 0;
                    if (airlineVal === 'AI') return r.aiAmount > 0;
                    if (airlineVal === 'SG') return r.sgAmount > 0;
                    return true;
                });
            }

            renderFiltered(filtered);
        }

        function applySearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = filteredData.filter(r => 
                r.id.toLowerCase().includes(query) ||
                getMonthYear(r.startDate).toLowerCase().includes(query) ||
                formatDate(r.endDate).toLowerCase().includes(query)
            );
            renderFiltered(filtered);
        }

        function renderFiltered(data) {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" style="text-align: center; padding: 40px; color: #95a5a6;">No records found</td></tr>';
                return;
            }

            data.forEach(row => {
                const tr = document.createElement('tr');
                const daysVal = row.days;
                const dayClass = daysVal < 0 ? 'style="color: #e74c3c; font-weight: 700;"' : '';

                tr.innerHTML = `
                    <td><strong>${getMonthYear(row.startDate)}</strong><br><small style="color: #95a5a6;">${row.id}</small></td>
                    <td class="number-cell">${formatDate(row.endDate)}</td>
                    <td class="number-cell">${formatDate(row.startDate)}</td>
                    <td class="number-cell" ${dayClass}>${daysVal} days</td>
                    <td class="number-cell">${formatCurrency(row.slAmount)}</td>
                    <td><span class="status-badge ${row.slStatus === 'PAID' ? 'status-paid' : 'status-pending'}">${row.slStatus}</span></td>
                    <td class="number-cell">${formatCurrency(row.aiAmount)}</td>
                    <td><span class="status-badge ${row.aiStatus === 'PAID' ? 'status-paid' : 'status-pending'}">${row.aiStatus}</span></td>
                    <td class="number-cell">${formatCurrency(row.sgAmount)}</td>
                    <td><span class="status-badge ${row.sgStatus === 'PAID' ? 'status-paid' : 'status-pending'}">${row.sgStatus}</span></td>
                    <td class="number-cell"><strong>${formatCurrency(row.total)}</strong></td>
                    <td class="number-cell" style="color: #27ae60; font-weight: 700;">${formatCurrency(row.paid)}</td>
                    <td class="number-cell" style="color: #e74c3c; font-weight: 700;">${formatCurrency(row.remaining)}</td>
                    <td class="number-cell">${formatCurrency(row.borrowed)}</td>
                    <td class="number-cell">${formatCurrency(row.avl)}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill progress-paid" style="width: ${row.total > 0 ? (row.paid / row.total * 100) : 0}%"></div>
                            <div class="progress-fill progress-pending" style="width: ${row.total > 0 ? ((row.total - row.paid - row.avl) / row.total * 100) : 0}%"></div>
                            <div class="progress-fill progress-avl" style="width: ${row.total > 0 ? (row.avl / row.total * 100) : 0}%"></div>
                        </div>
                        <small style="display: flex; gap: 12px; font-size: 0.75rem; margin-top: 4px;">
                            <span style="color: #27ae60;"><strong>‚úì</strong> ${row.total > 0 ? (row.paid / row.total * 100).toFixed(0) : 0}%</span>
                            <span style="color: #e74c3c;"><strong>‚ö†</strong> ${row.total > 0 ? ((row.total - row.paid - row.avl) / row.total * 100).toFixed(0) : 0}%</span>
                            <span style="color: #7f8c8d;"><strong>‚óê</strong> ${row.total > 0 ? (row.avl / row.total * 100).toFixed(0) : 0}%</span>
                        </small>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ==================== EXPORT FUNCTIONS ====================
        function exportCSV() {
            let csv = "Period,Invoice End,Remittance,Days,SL Amount,SL Status,AI Amount,AI Status,SG Amount,SG Status,Total,Paid,Remaining,Borrowed,AVL,Progress\n";
            
            filteredData.forEach(row => {
                const slNum = row.slAmount.toString();
                const aiNum = row.aiAmount.toString();
                const sgNum = row.sgAmount.toString();
                csv += `"${row.id}","${formatDate(row.endDate)}","${formatDate(row.startDate)}","${row.days}","${slNum}","${row.slStatus}","${aiNum}","${row.aiStatus}","${sgNum}","${row.sgStatus}","${row.total}","${row.paid}","${row.remaining}","${row.borrowed}","${row.avl}","${row.total > 0 ? (row.paid / row.total * 100).toFixed(0) : 0}%"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Airline-Dashboard-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);

            showNotification('üìÑ CSV exported successfully!');
        }

        function exportJSON() {
            const json = JSON.stringify(filteredData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Airline-Dashboard-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);

            showNotification('üìã JSON exported successfully!');
        }

        function copyTable() {
            let text = "Period\tInvoice End\tRemittance\tDays\tSL Amt\tSL Status\tAI Amt\tAI Status\tSG Amt\tSG Status\tTotal\tPaid\tRemaining\tBorrowed\tAVL\tProgress\n";
            
            filteredData.forEach(row => {
                text += `${row.id}\t${formatDate(row.endDate)}\t${formatDate(row.startDate)}\t${row.days}\t${row.slAmount}\t${row.slStatus}\t${row.aiAmount}\t${row.aiStatus}\t${row.sgAmount}\t${row.sgStatus}\t${row.total}\t${row.paid}\t${row.remaining}\t${row.borrowed}\t${row.avl}\t${row.total > 0 ? (row.paid / row.total * 100).toFixed(0) : 0}%\n`;
            });

            navigator.clipboard.writeText(text).then(() => {
                showNotification('‚úÖ Table copied to clipboard!');
            });
        }

        // ==================== PANEL CONTROLS ====================
        function toggleExportPanel() {
            const panel = document.getElementById('exportPanel');
            panel.classList.toggle('show');
        }

        function showSummary() {
            const panel = document.getElementById('summaryPanel');
            panel.classList.add('show');
        }

        function hideSummary() {
            const panel = document.getElementById('summaryPanel');
            panel.classList.remove('show');
        }

        // ==================== INITIALIZATION ====================
        function init() {
            // Populate period filter
            const periodSelect = document.getElementById('periodFilter');
            periods.forEach(period => {
                const option = document.createElement('option');
                option.value = period[0];
                option.textContent = getMonthYear(period[1]);
                periodSelect.appendChild(option);
            });

            // Build table
            buildTable();

            // Set last updated time
            document.getElementById('updateTime').textContent = new Date().toLocaleString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            // Close panels on outside click
            document.addEventListener('click', (e) => {
                const exportPanel = document.getElementById('exportPanel');
                const summaryPanel = document.getElementById('summaryPanel');
                
                if (!e.target.closest('.floating-panel') && !e.target.closest('.btn')) {
                    exportPanel.classList.remove('show');
                    summaryPanel.classList.remove('show');
                }
            });
        }

        // ==================== START ====================
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
