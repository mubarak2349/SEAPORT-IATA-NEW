<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seaport FN - Airline Payable Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            margin: 0;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.4em;
            margin-bottom: 8px;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        .header-subtitle {
            font-size: 0.95rem;
            opacity: 0.95;
            margin-bottom: 8px;
        }

        .credit-line {
            font-size: 0.85rem;
            opacity: 0.85;
            font-weight: 600;
        }

        /* MARQUEE - SLOWER */
        .marquee-container {
            background: linear-gradient(90deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 12px 20px;
            overflow: hidden;
            border-bottom: 3px solid #667eea;
        }

        .marquee {
            display: flex;
            animation: scroll 45s linear infinite;
            white-space: nowrap;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 1px;
            color: #ffffff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }

        .marquee-text {
            padding: 0 50px;
            display: inline-block;
        }

        .marquee-text a {
            color: #ffd700;
            text-decoration: none;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .marquee-text a:hover {
            color: #ffed4e;
            text-decoration: underline;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
        }

        @keyframes scroll {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        .marquee:hover {
            animation-play-state: paused;
        }

        /* CARDS AT TOP */
        .top-cards {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 3px solid #e1e4e8;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            max-width: 1800px;
            margin: 0 auto 20px auto;
        }

        .top-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .top-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .top-card.highlight {
            background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%);
            border-left-color: #27ae60;
        }

        .top-card-label {
            font-size: 0.75rem;
            color: #7f8c8d;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .top-card-value {
            font-size: 1.6rem;
            font-weight: 800;
            color: #667eea;
            font-family: 'Courier New', monospace;
        }

        .top-card-value.red {
            color: #e74c3c;
        }

        .top-card-value.green {
            color: #27ae60;
        }

        .top-card-value.orange {
            color: #e67e22;
        }

        /* AIRLINES SECTION */
        .airlines-section {
            max-width: 1800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .airlines-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 1rem;
            font-weight: 700;
            text-align: center;
        }

        .airlines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .airline-card {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .airline-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }

        .airline-card.paid {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #f0fef5 0%, #ffffff 100%);
        }

        .airline-card.pending {
            border-left-color: #e74c3c;
        }

        .airline-card-name {
            font-size: 0.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .airline-card-amount {
            font-family: 'Courier New', monospace;
            font-weight: 800;
            font-size: 1.5rem;
            color: #667eea;
            margin-bottom: 8px;
        }

        .airline-card-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .status-paid {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-pending {
            background: #fdeaea;
            color: #e74c3c;
        }

        /* MAIN LAYOUT */
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        /* RIGHT SIDE - TABLE */
        .right-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding: 0;
        }

        .control-bar {
            display: flex;
            gap: 10px;
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 2px solid #e1e4e8;
            flex-wrap: wrap;
        }

        .control-bar select,
        .control-bar input {
            padding: 10px 12px;
            border: 2px solid #e1e4e8;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .control-bar select:focus,
        .control-bar input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .control-bar input[type="search"] {
            flex: 1;
            min-width: 150px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #667eea;
            color: white;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-warning:hover {
            background: #e67e22;
        }

        .table-container {
            flex: 1;
            overflow-x: auto;
            overflow-y: auto;
            margin: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 14px 10px;
            text-align: left;
            white-space: nowrap;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #e1e4e8;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:nth-child(even) {
            background: #fafbfc;
        }

        tbody tr.current-row {
            background: linear-gradient(90deg, #f0f4ff 0%, #f8f9fa 100%);
            border-left: 4px solid #667eea;
        }

        tbody tr.current-row:hover {
            background: linear-gradient(90deg, #e8edff 0%, #f5f7fa 100%);
        }

        tbody tr.paid-row {
            background: linear-gradient(90deg, #f0fef5 0%, #f8fafb 100%);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .number-cell {
            font-family: 'Courier New', monospace;
            text-align: right;
            font-weight: 700;
        }

        .floating-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 550px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            z-index: 999;
            animation: slideUp 0.3s ease;
            display: none;
            flex-direction: column;
        }

        .floating-panel.show {
            display: flex;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 10px 10px 0 0;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 800;
        }

        .panel-close {
            cursor: pointer;
            font-size: 1.6rem;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .panel-close:hover {
            opacity: 1;
        }

        .panel-content {
            padding: 25px;
            flex: 1;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-weight: 600;
        }

        .summary-value {
            font-family: 'Courier New', monospace;
            font-weight: 800;
            color: #667eea;
        }

        .summary-section-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin: 15px 0 12px 0;
            font-size: 0.9rem;
            font-weight: 700;
        }

        footer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }

            .right-content {
                flex: 1;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.6rem;
            }

            .cards-grid,
            .airlines-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .control-bar {
                padding: 10px;
                gap: 8px;
            }

            table {
                font-size: 0.75rem;
            }

            th, td {
                padding: 8px 6px;
            }
        }

        @media (max-width: 480px) {
            .cards-grid,
            .airlines-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Seaport FN Airlines Payable - Dashboard</h1>
            <p class="header-subtitle">AIR DIVISION - Airline Payment Tracking System</p>
            <div class="credit-line">üîí View-Only Authentication</div>
        </header>

        <!-- MARQUEE -->
        <div class="marquee-container">
            <div class="marquee">
                <span class="marquee-text">|| Internal Tools dev by Mcode ||</span>

                <span class="marquee-text">
                    || <a href="https://aai-extract-tool-seaport-lines-air-coral.vercel.app/"
                         target="_blank" rel="noopener noreferrer">
                         Vendor Invoice Extract v2.9
                    </a> ||
                </span>

                <span class="marquee-text">
                    || <a href="https://kyc-seaport-lines-india-pvt-ltd-ws9.vercel.app/"
                         target="_blank" rel="noopener noreferrer">
                         KYC Form v3.0
                    </a> ||
                </span>

                <span class="marquee-text">
                    || <a href="https://seaport-air-div-caculation-tool-web.vercel.app/"
                         target="_blank" rel="noopener noreferrer">
                         Calculation Tools v3.1
                    </a> ||
                </span>

                <span class="marquee-text">
                    || Developed & Copyright ¬© Mcode 2026 @ Mubarak ||
                </span>
            </div>
        </div>

        <!-- TOP CARDS -->
        <div class="top-cards">
            <div class="cards-grid">
                <div class="top-card highlight">
                    <div class="top-card-label">Current Fortnight Period</div>
                    <div class="top-card-value" style="font-size: 1.2rem;" id="topPeriod">‚Äî</div>
                </div>

                <div class="top-card">
                    <div class="top-card-label">üìä Total Invoice</div>
                    <div class="top-card-value" id="topTotal">‚Çπ0</div>
                </div>
                <div class="top-card">
                    <div class="top-card-label">üìÖ Remittance</div>
                    <div class="top-card-value" style="font-size: 1.2rem;" id="topRemit">‚Äî</div>
                </div>
                <div class="top-card">
                    <div class="top-card-label">üö® Days Remaining</div>
                    <div class="top-card-value green" id="topDays">0</div>
                </div>
                <div class="top-card">
                    <div class="top-card-label">üè¶ AVL BAL IN 483 A/C</div>
                    <div class="top-card-value orange" id="topAVL">‚Çπ0</div>
                </div>
                <div class="top-card">
                    <div class="top-card-label">üíµ Outstanding</div>
                    <div class="top-card-value red" id="topPending">‚Çπ0</div>
                </div>
            </div>

            <div class="airlines-section">
                <div class="airlines-title">Current Period Airlines Breakdown</div>
                <div class="airlines-grid" id="airlinesGrid"></div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- TABLE -->
            <div class="right-content">
                <div class="control-bar">
                    <select id="periodFilter" onchange="applyFilter()">
                        <option value="">All Periods</option>
                    </select>
                    <select id="airlineFilter" onchange="applyFilter()">
                        <option value="">All Airlines</option>
                    </select>
                    <input type="search" id="searchInput" placeholder="üîç Search..." oninput="applySearch()">
                    <button class="btn" onclick="exportCSV()">üìÑ CSV</button>
                    <button class="btn" onclick="exportJSON()">üìã JSON</button>
                    <button class="btn btn-warning" onclick="showSummary()">üìà Summary</button>
                </div>

                <div class="table-container">
                    <table id="mainTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="floating-panel" id="summaryPanel">
            <div class="panel-header">
                <div class="panel-title">üìà Current Period Summary</div>
                <span class="panel-close" onclick="hideSummary()">‚úï</span>
            </div>
            <div class="panel-content" id="summaryContent"></div>
        </div>

        <footer>
            Airlines: <strong id="airlineCount">5</strong> | üìÖ Periods: <strong id="periodCount">27</strong> | üîÑ Last Updated: <strong id="lastUpdate">datetime</strong> | Powered by Mcode'2026 @ Mubarak
        </footer>
    </div>

    <script>
        const AIRLINES = [
            { code: "SL", name: "SriLankan Airlines" },
            { code: "AI", name: "Air India" },
            { code: "SQ", name: "Singapore Airlines" },
            { code: "TP", name: "Teleport Airlines" },
            { code: "OT", name: "Other Airlines" }
        ];
        
        const periods = [
            { id: "20251102F", dates: ["2025-12-09", "2025-12-30"], airlines: [["SL", 1411196, "PAID"], ["AI", 1061148, "PAID"], ["SQ", 1894593, "PAID"], ["TP", 0, "PAID"], ["OT", 0, "PAID"]], avl: 0 },
            { id: "20251201F", dates: ["2025-12-25", "2026-01-14"], airlines: [["SL", 1839350, "PAID"], ["AI", 489611, "PAID"], ["SQ", 2428937, "PAID"], ["TP", 0, "PAID"], ["OT", 0, "PAID"]], avl: 0 },
            { id: "20251202F", dates: ["2026-01-08", "2026-01-30"], airlines: [["SL", 2089753, "PAID"], ["AI", 724150, "PAID"], ["SQ", 1975908, "PAID"], ["TP", 0, "PAID"], ["OT", 0, "PAID"]], avl: 0 },
            { id: "20260101F", dates: ["2026-01-25", "2026-02-16"], airlines: [["SL", 1943404, "PENDING"], ["AI", 617083, "PENDING"], ["SQ", 2840655, "PENDING"], ["TP", 231085, "PENDING"], ["OT",  944507, "PENDING"]], avl: 515067 },
            { id: "20260102F", dates: ["2026-02-07", "2026-03-02"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260201F", dates: ["2026-02-24", "2026-03-17"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260202F", dates: ["2026-03-07", "2026-03-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260301F", dates: ["2026-03-25", "2026-04-14"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260302F", dates: ["2026-04-09", "2026-04-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260401F", dates: ["2026-04-25", "2026-05-15"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260402F", dates: ["2026-05-07", "2026-06-01"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260501F", dates: ["2026-05-27", "2026-06-15"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260502F", dates: ["2026-06-09", "2026-06-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260601F", dates: ["2026-06-25", "2026-07-15"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260602F", dates: ["2026-07-09", "2026-07-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260701F", dates: ["2026-07-25", "2026-08-14"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260702F", dates: ["2026-08-07", "2026-08-31"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260801F", dates: ["2026-08-26", "2026-09-14"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260802F", dates: ["2026-09-09", "2026-09-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260901F", dates: ["2026-09-24", "2026-10-15"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20260902F", dates: ["2026-10-08", "2026-10-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20261001F", dates: ["2026-10-25", "2026-11-16"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20261002F", dates: ["2026-11-07", "2026-11-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20261101F", dates: ["2026-11-25", "2026-12-15"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20261102F", dates: ["2026-12-09", "2026-12-30"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20261201F", dates: ["2026-12-24", "2027-01-14"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 },
            { id: "20261202F", dates: ["2027-01-07", "2027-02-01"], airlines: [["SL", 0, "PENDING"], ["AI", 0, "PENDING"], ["SQ", 0, "PENDING"], ["TP", 0, "PENDING"], ["OT", 0, "PENDING"]], avl: 0 }
        ];

        let filteredData = [];
        let currentPeriod = null;
        let currentPeriodId = null;

        function formatPeriodName(periodId) {
            const year = periodId.substring(0, 4);
            const month = periodId.substring(4, 6);
            const fn = periodId.substring(6, 8);
            
            const monthNames = {
                '01': 'JAN', '02': 'FEB', '03': 'MAR', '04': 'APR',
                '05': 'MAY', '06': 'JUN', '07': 'JUL', '08': 'AUG',
                '09': 'SEP', '10': 'OCT', '11': 'NOV', '12': 'DEC'
            };
            
            const fnNumber = parseInt(fn);
            const monthName = monthNames[month];
            const yearShort = year.substring(2, 4);
            
            return `${fnNumber} FN ${monthName}'${yearShort}`;
        }

        function formatCurrency(num) {
            if (!num) return "‚Çπ0";
            return "‚Çπ" + Math.abs(num).toLocaleString('en-IN', { maximumFractionDigits: 0 });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
        }

        function calculateDays(invoiceDate, remitDate) {
            const today = new Date();
            const remit = new Date(remitDate);
            const diff = Math.ceil((remit - today) / (1000 * 60 * 60 * 24));
            return diff;
        }

        function processPeriod(periodData) {
            const [invoiceDate, remitDate] = periodData.dates;
            
            let total = 0;
            let paid = 0;
            const airlineDetails = {};

            periodData.airlines.forEach(([code, amount, status]) => {
                total += amount;
                if (status === "PAID") {
                    paid += amount;
                }
                airlineDetails[code] = { amount, status };
            });

            const correctPending = total - paid - periodData.avl;

            return {
                id: periodData.id,
                invoiceDate,
                remitDate,
                total,
                paid,
                pending: correctPending,
                avl: periodData.avl,
                days: calculateDays(invoiceDate, remitDate),
                airlines: airlineDetails
            };
        }

        function getCurrentPeriod() {
            const today = new Date();
            let current = null;

            for (let i = 0; i < periods.length; i++) {
                const [invoiceDate, remitDate] = periods[i].dates;
                const invoice = new Date(invoiceDate);
                const remit = new Date(remitDate);
                
                if (today >= invoice && today <= remit) {
                    current = periods[i];
                    currentPeriodId = i;
                    break;
                }
            }

            if (!current) {
                current = periods[periods.length - 1];
                currentPeriodId = periods.length - 1;
            }

            return processPeriod(current);
        }

        function updateTopCards() {
            currentPeriod = getCurrentPeriod();

            document.getElementById('topPeriod').textContent = formatPeriodName(currentPeriod.id);
            document.getElementById('topTotal').textContent = formatCurrency(currentPeriod.total);
            document.getElementById('topRemit').textContent = formatDate(currentPeriod.remitDate);
            
            const daysVal = currentPeriod.days;
            const daysEl = document.getElementById('topDays');
            daysEl.textContent = daysVal;
            daysEl.className = 'top-card-value ' + (daysVal < 0 ? 'red' : 'green');
            
            document.getElementById('topAVL').textContent = formatCurrency(currentPeriod.avl);
            document.getElementById('topPending').textContent = formatCurrency(currentPeriod.pending);

            // Update airlines grid in top section
            let airlinesHTML = '';
            AIRLINES.forEach(airline => {
                const code = airline.code;
                const data = currentPeriod.airlines[code];
                if (data) {
                    const statusClass = data.status === 'PAID' ? 'status-paid paid' : 'status-pending pending';
                    const amountColor = data.status === 'PAID' ? '#27ae60' : '#667eea';
                    
                    airlinesHTML += `
                        <div class="airline-card ${statusClass.split(' ')[1]}">
                            <div class="airline-card-name">${code} - ${airline.name}</div>
                            <div class="airline-card-amount" style="color: ${amountColor};">${formatCurrency(data.amount)}</div>
                            <span class="airline-card-status ${statusClass}">${data.status}</span>
                        </div>
                    `;
                }
            });

            document.getElementById('airlinesGrid').innerHTML = airlinesHTML;
        }

        function buildTable() {
            const thead = document.getElementById('tableHead');
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';
            filteredData = [];

            let headerHTML = '<tr><th>Period</th><th>Invoice</th><th>Remittance</th><th>Days</th>';
            AIRLINES.forEach(airline => {
                headerHTML += `<th colspan="2">${airline.code}<br><small>${airline.name}</small></th>`;
            });
            headerHTML += '<th>Total</th><th>Paid</th><th>Pending</th><th>AVL</th><th>Progress</th></tr>';
            thead.innerHTML = headerHTML;

            periods.forEach((periodData, idx) => {
                const row = processPeriod(periodData);
                filteredData.push(row);

                const tr = document.createElement('tr');
                
                if (idx === currentPeriodId) {
                    tr.classList.add('current-row');
                } else {
                    tr.classList.add('paid-row');
                }

                const daysVal = row.days;
                const dayStyle = daysVal < 0 ? 'color: #e74c3c; font-weight: 800;' : 'color: #27ae60;';

                let rowHTML = `
                    <td><strong>${formatPeriodName(row.id)}</strong></td>
                    <td class="number-cell">${formatDate(row.invoiceDate)}</td>
                    <td class="number-cell">${formatDate(row.remitDate)}</td>
                    <td class="number-cell" style="${dayStyle}">${daysVal}</td>
                `;

                AIRLINES.forEach(airline => {
                    const code = airline.code;
                    const data = row.airlines[code];
                    const amt = data ? data.amount : 0;
                    const status = data ? data.status : "PENDING";
                    rowHTML += `
                        <td class="number-cell">${formatCurrency(amt)}</td>
                        <td><span class="status-badge ${status === 'PAID' ? 'status-paid' : 'status-pending'}">${status}</span></td>
                    `;
                });

                const paidPct = row.total > 0 ? Math.round((row.paid / row.total) * 100) : 0;
                const avlPct = row.total > 0 ? Math.round((row.avl / row.total) * 100) : 0;
                const pendingPct = row.total > 0 ? 100 - paidPct - avlPct : 0;

                rowHTML += `
                    <td class="number-cell"><strong>${formatCurrency(row.total)}</strong></td>
                    <td class="number-cell" style="color: #27ae60; font-weight: 800;">${formatCurrency(row.paid)}</td>
                    <td class="number-cell" style="color: #e74c3c; font-weight: 800;">${formatCurrency(row.pending)}</td>
                    <td class="number-cell" style="color: #95a5a6;">${formatCurrency(row.avl)}</td>
                    <td>
                        <div style="width: 100%; height: 24px; background: #ecf0f1; border-radius: 4px; overflow: hidden; display: flex; border: 1px solid #bdc3c7;">
                            ${paidPct > 0 ? `<div style="width: ${paidPct}%; background: #27ae60; height: 100%;"></div>` : ''}
                            ${pendingPct > 0 ? `<div style="width: ${pendingPct}%; background: #e74c3c; height: 100%;"></div>` : ''}
                            ${avlPct > 0 ? `<div style="width: ${avlPct}%; background: #95a5a6; height: 100%;"></div>` : ''}
                        </div>
                        <small style="display: flex; gap: 10px; font-size: 0.7rem; margin-top: 3px; font-weight: 700;">
                            <span style="color: #27ae60;">üü¢${paidPct}%</span>
                            <span style="color: #e74c3c;">üî¥${pendingPct}%</span>
                            ${avlPct > 0 ? `<span style="color: #95a5a6;">‚ö´${avlPct}%</span>` : ''}
                        </small>
                    </td>
                `;

                tr.innerHTML = rowHTML;
                tbody.appendChild(tr);
            });

            updateTopCards();
        }

        function applyFilter() {
            const periodVal = document.getElementById('periodFilter').value;
            const airlineVal = document.getElementById('airlineFilter').value;

            let filtered = [...filteredData];

            if (periodVal) {
                filtered = filtered.filter(r => r.id === periodVal);
            }

            if (airlineVal) {
                filtered = filtered.filter(r => r.airlines[airlineVal] && r.airlines[airlineVal].amount > 0);
            }

            renderFiltered(filtered);
        }

        function applySearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = filteredData.filter(r => 
                r.id.toLowerCase().includes(query) ||
                formatPeriodName(r.id).toLowerCase().includes(query) ||
                formatDate(r.invoiceDate).toLowerCase().includes(query)
            );
            renderFiltered(filtered);
        }

        function renderFiltered(data) {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="20" style="text-align: center; padding: 40px; color: #95a5a6;">No records found</td></tr>';
                return;
            }

            data.forEach(row => {
                const tr = document.createElement('tr');
                
                if (row.id === currentPeriod.id) {
                    tr.classList.add('current-row');
                } else {
                    tr.classList.add('paid-row');
                }

                const daysVal = row.days;
                const dayStyle = daysVal < 0 ? 'color: #e74c3c; font-weight: 800;' : 'color: #27ae60;';

                let rowHTML = `
                    <td><strong>${formatPeriodName(row.id)}</strong></td>
                    <td class="number-cell">${formatDate(row.invoiceDate)}</td>
                    <td class="number-cell">${formatDate(row.remitDate)}</td>
                    <td class="number-cell" style="${dayStyle}">${daysVal}</td>
                `;

                AIRLINES.forEach(airline => {
                    const code = airline.code;
                    const data = row.airlines[code];
                    const amt = data ? data.amount : 0;
                    const status = data ? data.status : "PENDING";
                    rowHTML += `
                        <td class="number-cell">${formatCurrency(amt)}</td>
                        <td><span class="status-badge ${status === 'PAID' ? 'status-paid' : 'status-pending'}">${status}</span></td>
                    `;
                });

                const paidPct = row.total > 0 ? Math.round((row.paid / row.total) * 100) : 0;
                const avlPct = row.total > 0 ? Math.round((row.avl / row.total) * 100) : 0;
                const pendingPct = row.total > 0 ? 100 - paidPct - avlPct : 0;

                rowHTML += `
                    <td class="number-cell"><strong>${formatCurrency(row.total)}</strong></td>
                    <td class="number-cell" style="color: #27ae60; font-weight: 800;">${formatCurrency(row.paid)}</td>
                    <td class="number-cell" style="color: #e74c3c; font-weight: 800;">${formatCurrency(row.pending)}</td>
                    <td class="number-cell" style="color: #95a5a6;">${formatCurrency(row.avl)}</td>
                    <td>
                        <div style="width: 100%; height: 24px; background: #ecf0f1; border-radius: 4px; overflow: hidden; display: flex; border: 1px solid #bdc3c7;">
                            ${paidPct > 0 ? `<div style="width: ${paidPct}%; background: #27ae60; height: 100%;"></div>` : ''}
                            ${pendingPct > 0 ? `<div style="width: ${pendingPct}%; background: #e74c3c; height: 100%;"></div>` : ''}
                            ${avlPct > 0 ? `<div style="width: ${avlPct}%; background: #95a5a6; height: 100%;"></div>` : ''}
                        </div>
                        <small style="display: flex; gap: 10px; font-size: 0.7rem; margin-top: 3px; font-weight: 700;">
                            <span style="color: #27ae60;">üü¢${paidPct}%</span>
                            <span style="color: #e74c3c;">üî¥${pendingPct}%</span>
                            ${avlPct > 0 ? `<span style="color: #95a5a6;">‚ö´${avlPct}%</span>` : ''}
                        </small>
                    </td>
                `;

                tr.innerHTML = rowHTML;
                tbody.appendChild(tr);
            });
        }

        function exportCSV() {
            let csv = "Period,Invoice,Remittance,Days," + AIRLINES.map(a => `${a.code}_Amount,${a.code}_Status`).join(',') + ",Total,Paid,Pending,AVL\n";
            
            filteredData.forEach(row => {
                let airlineData = AIRLINES.map(airline => {
                    const data = row.airlines[airline.code];
                    return `"${data ? data.amount : 0}","${data ? data.status : 'PENDING'}"`;
                }).join(',');
                
                csv += `"${formatPeriodName(row.id)}","${formatDate(row.invoiceDate)}","${formatDate(row.remitDate)}","${row.days}",${airlineData},"${row.total}","${row.paid}","${row.pending}","${row.avl}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SeaportFN-Dashboard-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function exportJSON() {
            const json = JSON.stringify(filteredData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SeaportFN-Dashboard-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function showSummary() {
            if (!currentPeriod) return;

            let html = `
                <div style="background: linear-gradient(135deg, #f0f4ff 0%, #ffffff 100%); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #667eea;">
                    <h3 style="color: #667eea; margin-bottom: 8px; font-size: 1.1rem; font-weight: 800;">üìç ${formatPeriodName(currentPeriod.id)}</h3>
                    <div style="font-size: 0.9rem; color: #2c3e50;">
                        <strong>Remittance:</strong> ${formatDate(currentPeriod.remitDate)} | 
                        <strong>Days:</strong> <span style="color: ${currentPeriod.days < 0 ? '#e74c3c' : '#27ae60'}; font-weight: 800;">${currentPeriod.days}</span>
                    </div>
                </div>

                <div class="summary-section-title">üí∞ Financial Summary</div>
                <div class="summary-item">
                    <span>Total Invoice:</span>
                    <span class="summary-value">${formatCurrency(currentPeriod.total)}</span>
                </div>
                
                <div class="summary-item">
                    <span>AVL BAL IN 483 A/C:</span>
                    <span class="summary-value" style="color: #e67e22;">${formatCurrency(currentPeriod.avl)}</span>
                </div>
                <div class="summary-item">
                    <span>Outstanding (Pending):</span>
                    <span class="summary-value" style="color: #e74c3c;">${formatCurrency(currentPeriod.pending)}</span>
                </div>
                <div class="summary-item">
                    <span>Amount Paid:</span>
                    <span class="summary-value" style="color: #27ae60;">${formatCurrency(currentPeriod.paid)}</span>
                </div>

                <div class="summary-section-title">‚úàÔ∏è Airlines Breakdown</div>
            `;

            AIRLINES.forEach(airline => {
                const data = currentPeriod.airlines[airline.code];
                if (data) {
                    const statusColor = data.status === 'PAID' ? '#27ae60' : '#e74c3c';
                    html += `
                        <div class="summary-item" style="border-left-color: ${statusColor};">
                            <span style="font-weight: 700;">${airline.code} - ${airline.name}</span>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <span class="summary-value">${formatCurrency(data.amount)}</span>
                                <span style="background: ${data.status === 'PAID' ? '#d5f4e6' : '#fdeaea'}; color: ${statusColor}; padding: 4px 10px; border-radius: 10px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase;">${data.status}</span>
                            </div>
                        </div>
                    `;
                }
            });

            document.getElementById('summaryContent').innerHTML = html;
            document.getElementById('summaryPanel').classList.add('show');
        }

        function hideSummary() {
            document.getElementById('summaryPanel').classList.remove('show');
        }

        function init() {
            const today = new Date();

            const periodSelect = document.getElementById('periodFilter');
            periods.forEach(period => {
                const option = document.createElement('option');
                option.value = period.id;
                option.textContent = formatPeriodName(period.id);
                periodSelect.appendChild(option);
            });

            const airlineSelect = document.getElementById('airlineFilter');
            AIRLINES.forEach(airline => {
                const option = document.createElement('option');
                option.value = airline.code;
                option.textContent = `${airline.code} - ${airline.name}`;
                airlineSelect.appendChild(option);
            });

            buildTable();

            document.getElementById('airlineCount').textContent = AIRLINES.length;
            document.getElementById('periodCount').textContent = periods.length;
            document.getElementById('lastUpdate').textContent = today.toLocaleDateString('en-IN');

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.floating-panel') && !e.target.closest('.btn')) {
                    hideSummary();
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>


